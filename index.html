<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì „ë¬¸ ì˜í™” íë ˆì´ì…˜ ì„œë¹„ìŠ¤ ì„ íƒ (ë ˆì´ì•„ì›ƒ ë³µêµ¬ ë° ê²€ìƒ‰ í™•ì¸)</title>
    <!-- Tailwind CSS CDN ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- ì‚¬ìš©ì ì •ì˜ CSS ë° ë””ìì¸ ë³€ìˆ˜ ì„¤ì • -->
    <style>
        /* ---------------------------------------------------- */
        /* === ë””ìì¸ ì„¤ì • ë³€ìˆ˜ (ì‚¬ìš©ì ìˆ˜ì • ì˜ì—­) === */
        /* ---------------------------------------------------- */
        :root {
            /* 1. ê¸°ë³¸ ë°°ê²½ìƒ‰ ë° ì „ì²´ í…Œë§ˆ (Primary Background & Theme) */
            --main-bg-color: #111111;  /* ì „ì²´ í˜ì´ì§€ ë°°ê²½ìƒ‰ (í˜„ì¬: ê±°ì˜ ê²€ì •) */
            --app-bg-color: #000000;   /* ë©”ì¸ ì»¨í…Œì´ë„ˆ ë°°ê²½ìƒ‰ (í˜„ì¬: ê²€ì •) */
            --text-color: #ffffff;     /* ê¸°ë³¸ ê¸€ììƒ‰ (í˜„ì¬: í°ìƒ‰) */
            
            /* 2. ê°•ì¡°ìƒ‰ ë° ë²„íŠ¼ (Accent Color & Buttons) */
            --accent-color: #ffffff;   /* ë²„íŠ¼ ë° ê°•ì¡° ìš”ì†Œì˜ ê¸°ë³¸ ìƒ‰ìƒ (í˜„ì¬: í°ìƒ‰) */
            --accent-text-color: #111111; /* ê°•ì¡°ìƒ‰ ìœ„ ê¸€ììƒ‰ (í˜„ì¬: ê²€ì •) */
            --card-border-color: #333333; /* ì¹´ë“œ/ë¸”ë¡ í…Œë‘ë¦¬ ìƒ‰ìƒ (í˜„ì¬: ì§™ì€ íšŒìƒ‰) */
            
            /* 3. ì¹´ë“œ ë° ì…ë ¥ í•„ë“œ ë°°ê²½ìƒ‰ (Card & Input Background) */
            --card-bg-color: #1a1a1a;  /* ì„œë¹„ìŠ¤ ì„ íƒ ì¹´ë“œ, ì…ë ¥ í¼ ë°°ê²½ìƒ‰ (í˜„ì¬: ë§¤ìš° ì§™ì€ íšŒìƒ‰) */
            --input-bg-color: #262626; /* ì…ë ¥ í•„ë“œ ë‚´ë¶€ ë°°ê²½ìƒ‰ (í˜„ì¬: ë” ì§™ì€ íšŒìƒ‰) */
        }
        
        /* ---------------------------------------------------- */
        /* === í°íŠ¸ ì„¤ì • (ìˆ˜ì • ê°€ëŠ¥) === */
        /* ---------------------------------------------------- */
        /* Oswald: ì œëª©ìš© í°íŠ¸ (ê³ ë”• ê³„ì—´, êµµê³  ëª¨ë˜í•¨) */
        /* Inter: ë³¸ë¬¸ìš© í°íŠ¸ (ê¹”ë”í•œ ê³ ë”•) */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300..700&family=Oswald:wght@500..700&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--main-bg-color); /* ë°°ê²½ìƒ‰ ì ìš© */
            color: var(--text-color); /* ê¸°ë³¸ ê¸€ììƒ‰ ì ìš© */
        }
        
        h1, h2, h4 {
            font-family: 'Oswald', sans-serif; 
            letter-spacing: -0.05em; /* ì œëª© ê¸€ì ê°„ê²© ì¢ê²Œ */
        }
        
        /* ---------------------------------------------------- */
        /* === ì£¼ìš” ìš”ì†Œ ë””ìì¸ (í´ë˜ìŠ¤ ì„¤ëª… ì°¸ê³ í•˜ì—¬ ìˆ˜ì •) === */
        /* ---------------------------------------------------- */
        
        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
        .main-container-block {
            border: 1px solid var(--card-border-color); /* í…Œë‘ë¦¬ìƒ‰ ì ìš© */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2);
            background-color: var(--app-bg-color); /* ë©”ì¸ ì»¨í…Œì´ë„ˆ ë°°ê²½ìƒ‰ ì ìš© */
        }
        
        /* ì¶”ì²œ ê²°ê³¼ ì¶œë ¥ ë¸”ë¡ (í°ìƒ‰ í…Œë§ˆ) */
        #recommendationOutput {
            /* ì¶”ì²œ ê²°ê³¼ ë¸”ë¡ì€ íŠ¹ë³„íˆ í°ìƒ‰(bg-white)ìœ¼ë¡œ ìœ ì§€í•˜ê³ , ì§™ì€ ê·¸ë¦¼ìë¥¼ ì¤ë‹ˆë‹¤. */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.05); 
            border: none;
        }
        
        /* í‚¤ì›Œë“œ íƒœê·¸ ìŠ¤íƒ€ì¼ (ì„ íƒë˜ì§€ ì•Šì€ ìƒíƒœ) */
        .keyword-tag {
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
            border: 1px solid var(--card-border-color); /* í…Œë‘ë¦¬ìƒ‰ ì ìš© */
            background-color: var(--card-bg-color); /* íƒœê·¸ ë°°ê²½ìƒ‰ ì ìš© */
            color: #ddd; /* ê¸€ììƒ‰ ì‚´ì§ ì—°í•˜ê²Œ */
        }
        
        /* í‚¤ì›Œë“œ íƒœê·¸ (ì„ íƒëœ ìƒíƒœ) */
        .keyword-tag.selected {
            transform: scale(1.05);
            background-color: var(--accent-color); /* ê°•ì¡°ìƒ‰ ì ìš© */
            color: var(--accent-text-color); /* ê°•ì¡°ìƒ‰ ìœ„ ê¸€ììƒ‰ ì ìš© */
            border-color: var(--accent-color);
            font-weight: 600;
        }
        
        /* ë©”ì¸ ì•¡ì…˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .main-action-btn {
            background-color: var(--accent-color); /* ê°•ì¡°ìƒ‰ ì ìš© */
            color: var(--accent-text-color); /* ê°•ì¡°ìƒ‰ ìœ„ ê¸€ììƒ‰ ì ìš© */
            transition: background-color 0.2s, color 0.2s;
            border-bottom: 2px solid #555; /* ë²„íŠ¼ ì•„ë˜ ê·¸ë¦¼ì/ê²½ê³„ */
        }
        .main-action-btn:hover {
            background-color: #dddddd; /* ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ ìƒ‰ìƒ (ì§ì ‘ ìˆ˜ì • ê°€ëŠ¥) */
        }

    </style>
</head>
<body class="min-h-screen p-4 md:p-8">

    <!-- ========================================================================= -->
    <!-- [A] ë©”ì¸ ì»¨í…Œì´ë„ˆ: ì „ì²´ í¬ê¸° ë° ë°°ê²½ ì„¤ì • -->
    <!-- ========================================================================= -->
    <div id="app" class="max-w-5xl mx-auto main-container-block rounded-lg p-6 md:p-12 border-t-4 border-white/50">
        <!-- 
            - max-w-5xl: ìµœëŒ€ ë„ˆë¹„ ì„¤ì • (xl ì‚¬ì´ì¦ˆ)
            - mx-auto: ê°€ë¡œ ì¤‘ì•™ ì •ë ¬
            - main-container-block: CSS ë³€ìˆ˜ê°€ ì ìš©ëœ ë°°ê²½/í…Œë‘ë¦¬ ìŠ¤íƒ€ì¼
            - rounded-lg: ëª¨ì„œë¦¬ ë‘¥ê¸€ê¸° (large)
            - p-6 md:p-12: ë‚´ë¶€ íŒ¨ë”© (ëª¨ë°”ì¼: p-6, ë°ìŠ¤í¬íƒ‘: p-12)
            - border-t-4 border-white/50: ìƒë‹¨ì— 4px ë‘ê»˜ì˜ í°ìƒ‰(50% íˆ¬ëª…ë„) ê²½ê³„ì„  
        -->
        
        <!-- [A-1] í—¤ë” ì˜ì—­: ì œëª© ë° ì„¤ëª… -->
        <header class="mb-12 text-center">
            <!-- ì œëª© ê¸€ì í¬ê¸°, êµµê¸°, ìƒ‰ìƒ -->
            <h1 class="text-6xl font-bold text-white mb-2">Personal CuratoR</h1>
            <!-- ì„¤ëª… ê¸€ì í¬ê¸°, ìƒ‰ìƒ, êµµê¸° -->
            <p class="text-lg text-gray-400 font-light">ë§ì¶¤í˜• ì˜í™” ì¶”ì²œ ì„œë¹„ìŠ¤</p>
        </header>

        <!-- ========================================================================= -->
        <!-- [B] ì„œë¹„ìŠ¤ ì„ íƒ í™”ë©´ (ì´ˆê¸° í™”ë©´) -->
        <!-- ========================================================================= -->
        <div id="selectionView" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- grid-cols-1: ëª¨ë°”ì¼ì—ì„œëŠ” 1ì—´, lg:grid-cols-2: ë°ìŠ¤í¬íƒ‘ì—ì„œëŠ” 2ì—´ -->
            <!-- gap-6: ì¹´ë“œ ê°„ ê°„ê²© -->
            
            <!-- [B-1] ì¹´ë“œ 1: Vibe ê¸°ë°˜ ì¶”ì²œ -->
            <div id="selectVibe" class="modern-block p-8 rounded-lg border border-gray-800 hover:border-gray-500 transition duration-300 cursor-pointer" style="background-color: var(--card-bg-color);" data-service="vibe">
                <div class="text-gray-200 mb-4">
                    <!-- ì•„ì´ì½˜ (SVG) -->
                    <svg class="w-10 h-10 mx-auto" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M15 10l4.55 2.275a.5.5 0 010 .89L15 15.65V10zM5.5 10h9M5.5 15h9M12 21a9 9 0 100-18 9 9 0 000 18z"></path></svg>
                </div>
                <h2 class="text-3xl font-bold text-center text-white mb-3">ì‹œì²­ ê¸°ë¡ ê¸°ë°˜ (VIBE)</h2>
                <p class="text-gray-300 text-center font-light">ì¢‹ì•„í•˜ëŠ” ì˜í™”ë“¤ì—ì„œ ê³µí†µëœ ë¶„ìœ„ê¸°ë¥¼ ì¶”ì¶œí•˜ì—¬,<br>ê·¸ ë¶„ìœ„ê¸°ì— ê°€ì¥ ì™„ë²½í•˜ê²Œ ë§ëŠ” ìƒˆë¡œìš´ ì˜í™”ë¥¼ ì¶”ì²œë°›ìŠµë‹ˆë‹¤.</p>
                <button class="main-action-btn mt-6 w-full py-3 rounded-md font-semibold text-base">
                    ì´ ëª¨ë“œ ì„ íƒí•˜ê¸°
                </button>
            </div>

            <!-- [B-2] ì¹´ë“œ 2: Keyword ê¸°ë°˜ ì¶”ì²œ -->
            <div id="selectKeyword" class="modern-block p-8 rounded-lg border border-gray-800 hover:border-gray-500 transition duration-300 cursor-pointer" style="background-color: var(--card-bg-color);" data-service="keyword">
                <div class="text-gray-200 mb-4">
                    <!-- ì•„ì´ì½˜ (SVG) -->
                    <svg class="w-10 h-10 mx-auto" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M14 10a2 2 0 10-4 0m4 0h3a2 2 0 012 2v10H5V12a2 2 0 012-2h3M9 6h6"></path></svg>
                </div>
                <h2 class="text-3xl font-bold text-center text-white mb-3">í‚¤ì›Œë“œ ê¸°ë°˜ (NARROW)</h2>
                <p class="text-gray-300 text-center font-light">ì›í•˜ëŠ” ì¥ë¥´, ë¶„ìœ„ê¸°, ì£¼ì œ ë“±ì˜ ì¡°ê±´ì„ ì§ì ‘ ì…ë ¥í•˜ê±°ë‚˜<br>ëª©ë¡ì—ì„œ ì •êµí•˜ê²Œ ì„ íƒí•˜ì—¬ ë§ì¶¤í˜• ëª©ë¡ì„ ì œê³µë°›ìŠµë‹ˆë‹¤.</p>
                <button class="main-action-btn mt-6 w-full py-3 rounded-md font-semibold text-base">
                    ì´ ëª¨ë“œ ì„ íƒí•˜ê¸°
                </button>
            </div>
        </div>

        <!-- ========================================================================= -->
        <!-- [C] ëª¨ë“œ ì„ íƒ í›„ì˜ ê³µí†µ ë·° (í¼, ë¡œë”©, ê²°ê³¼ í¬í•¨) -->
        <!-- ========================================================================= -->
        <div id="serviceView" class="hidden mt-10 border-t border-gray-800 pt-8">
            <!-- mt-10: ìƒë‹¨ ë§ˆì§„, border-t: ìƒë‹¨ ê²½ê³„ì„ , pt-8: ìƒë‹¨ íŒ¨ë”© -->
            
            <!-- [C-1] ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
            <button id="backToSelection" class="text-gray-500 hover:text-white mb-8 flex items-center transition duration-200 text-sm font-medium">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                ë©”ì¸ ì„œë¹„ìŠ¤ ì„ íƒìœ¼ë¡œ ëŒì•„ê°€ê¸°
            </button>
            
            <!-- í˜„ì¬ ì„œë¹„ìŠ¤ ëª¨ë“œ ì œëª© -->
            <h2 id="serviceTitle" class="text-4xl font-bold mb-10 text-center text-white uppercase"></h2>
            
            <!-- [C-2] ë¡œë”© ì¸ë””ì¼€ì´í„° (ì˜í™” ë¶„ì„ ì¤‘...) -->
            <div id="loading" class="text-center py-12 hidden">
                <div class="animate-spin rounded-full h-12 w-12 border-b-4 border-white/50 mx-auto mb-4"></div>
                <p class="text-gray-400 font-semibold text-xl" id="loadingText">ì˜í™” ë°ì´í„°ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</p>
            </div>

            <!-- ========================================================================= -->
            <!-- [D] 1. VIBE ëª¨ë“œ ì…ë ¥ í¼ (ìˆ˜ì •ë¨: ë™ì  ì…ë ¥ ì¹¸ ì¶”ê°€ ë° ìµœì†Œ 1ê°œ ì…ë ¥ í—ˆìš©) -->
            <!-- ========================================================================= -->
            <div id="vibeForm" class="hidden max-w-2xl mx-auto space-y-5 p-6 rounded-lg modern-block" style="background-color: var(--card-bg-color);">
                <!-- ì•ˆë‚´ ë¬¸êµ¬ ìˆ˜ì •: ìµœì†Œ 1ê°œ, ì…ë ¥ ê°œìˆ˜ ë¬´ì œí•œ -->
                <p class="text-gray-300 font-medium text-base border-b border-gray-700 pb-4">ìµœì†Œ 1ê°œ ì´ìƒì˜ ì˜í™” ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì…ë ¥ ê°œìˆ˜ì— ì œí•œ ì—†ìŒ)</p>
                
                <!-- ì…ë ¥ í•„ë“œ ì»¨í…Œì´ë„ˆ -->
                <div id="vibeInputsContainer" class="space-y-4">
                    <!-- ì´ˆê¸° 3ê°œ ì…ë ¥ í•„ë“œ -->
                    <input type="text" data-movie-input placeholder="ì¢‹ì•„í•˜ëŠ” ì˜í™” 1 (í•„ìˆ˜)" class="vibe-movie-input w-full p-4 border border-gray-700 rounded-md focus:ring-white/50 focus:border-white/50 text-white placeholder-gray-500" style="background-color: var(--input-bg-color);">
                    <input type="text" data-movie-input placeholder="ì¢‹ì•„í•˜ëŠ” ì˜í™” 2 (ì„ íƒ)" class="vibe-movie-input w-full p-4 border border-gray-700 rounded-md focus:ring-white/50 focus:border-white/50 text-white placeholder-gray-500" style="background-color: var(--input-bg-color);">
                    <input type="text" data-movie-input placeholder="ì¢‹ì•„í•˜ëŠ” ì˜í™” 3 (ì„ íƒ)" class="vibe-movie-input w-full p-4 border border-gray-700 rounded-md focus:ring-white/50 focus:border-white/50 text-white placeholder-gray-500" style="background-color: var(--input-bg-color);">
                </div>
                
                <!-- ì…ë ¥ í•„ë“œ ì¶”ê°€ ë²„íŠ¼ -->
                <button id="addVibeMovieInputBtn" class="w-full py-2 rounded-md font-medium text-sm border-2 border-gray-600 text-gray-400 hover:border-white hover:text-white transition duration-200 mt-2">
                    + ì˜í™” ì…ë ¥ ì¹¸ ì¶”ê°€í•˜ê¸°
                </button>

                <button id="getVibeRecommendationBtn" class="main-action-btn w-full py-4 rounded-md font-bold text-lg transition duration-300 shadow-xl mt-6 flex items-center justify-center">
                    <span id="vibeBtnText">ìœ ì‚¬í•œ ì˜í™” 5í¸ ì¶”ì²œë°›ê¸°</span>
                    <div id="vibeSpinner" class="animate-spin rounded-full h-5 w-5 border-b-2 ml-2 hidden" style="border-bottom-color: var(--accent-text-color);"></div>
                </button>
            </div>

            <!-- ========================================================================= -->
            <!-- [E] 2. KEYWORD ëª¨ë“œ ì„œë¸Œ ì„ íƒ í™”ë©´ (ì§ì ‘ ì…ë ¥ vs ëª©ë¡ ì„ íƒ) -->
            <!-- ========================================================================= -->
            <div id="keywordSubSelectionView" class="hidden max-w-3xl mx-auto space-y-6">
                <h3 class="text-2xl font-semibold text-center text-white border-b border-gray-700 pb-4">í‚¤ì›Œë“œ ì…ë ¥ ë°©ì‹ ì„ íƒ</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <!-- ì„œë¸Œ ì„ íƒ ì¹´ë“œ 1: ì§ì ‘ ì…ë ¥ -->
                    <div id="selectDirectInput" class="modern-block p-6 rounded-lg border border-gray-800 hover:border-white/50 transition duration-300 cursor-pointer" style="background-color: var(--card-bg-color);">
                        <h4 class="text-xl font-bold text-white mb-2">A. í‚¤ì›Œë“œ ì§ì ‘ ì…ë ¥ (ììœ  ì„œìˆ )</h4>
                        <p class="text-gray-400 text-sm">ì›í•˜ëŠ” ë¶„ìœ„ê¸°ë‚˜ ì¡°ê±´ì„ ììœ ë¡­ê²Œ ì„œìˆ í•©ë‹ˆë‹¤.</p>
                        <button class="main-action-btn mt-4 w-full py-2 rounded-md font-medium text-sm">
                            ì§ì ‘ ì…ë ¥ ëª¨ë“œ ì‹œì‘
                        </button>
                    </div>
                    <!-- ì„œë¸Œ ì„ íƒ ì¹´ë“œ 2: ëª©ë¡ì—ì„œ ì„ íƒ -->
                    <div id="selectKeywordList" class="modern-block p-6 rounded-lg border border-gray-800 hover:border-white/50 transition duration-300 cursor-pointer" style="background-color: var(--card-bg-color);">
                        <h4 class="text-xl font-bold text-white mb-2">B. ëª©ë¡ì—ì„œ í‚¤ì›Œë“œ ì„ íƒ (ì •êµí•¨)</h4>
                        <p class="text-gray-400 text-sm">ì œê³µë˜ëŠ” ë¦¬ìŠ¤íŠ¸ì—ì„œ ì›í•˜ëŠ” í‚¤ì›Œë“œë§Œ ê³¨ë¼ ì„ íƒí•©ë‹ˆë‹¤.</p>
                        <button class="main-action-btn mt-4 w-full py-2 rounded-md font-medium text-sm">
                            ì„ íƒ ëª¨ë“œ ì‹œì‘
                        </button>
                    </div>
                </div>
            </div>


            <!-- ========================================================================= -->
            <!-- [F] 2A. KEYWORD ì§ì ‘ ì…ë ¥ í¼ -->
            <!-- ========================================================================= -->
            <div id="keywordForm" class="hidden max-w-2xl mx-auto space-y-5 p-6 rounded-lg modern-block" style="background-color: var(--card-bg-color);">
                <p class="text-gray-300 font-medium text-base border-b border-gray-700 pb-4">ì›í•˜ëŠ” ì˜í™”ì˜ ë¶„ìœ„ê¸°, ì¥ë¥´ ë“± êµ¬ì²´ì ì¸ í‚¤ì›Œë“œë¥¼ ììœ ë¡­ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
                <textarea id="keywordInput" rows="4" class="w-full p-4 border border-gray-700 rounded-md focus:ring-white/50 focus:border-white/50 text-white placeholder-gray-500" placeholder="ì˜ˆì‹œ: 'ê¸´ì¥ê° ë„˜ì¹˜ëŠ” ìŠ¤ë¦´ëŸ¬', 'ëª½í™˜ì ì¸ ì˜ìƒë¯¸ê°€ ê°€ë“í•œ ìœ ëŸ½ ì˜í™”', '90ë…„ëŒ€ í™ì½© ëˆ„ì•„ë¥´ ë¶„ìœ„ê¸°'" style="background-color: var(--input-bg-color);"></textarea>
                
                <button id="getKeywordRecommendationBtn" class="main-action-btn w-full py-4 rounded-md font-bold text-lg transition duration-300 shadow-xl mt-6 flex items-center justify-center">
                    <span id="keywordBtnText">í‚¤ì›Œë“œì— ë§ëŠ” ì˜í™” 5í¸ ì¶”ì²œë°›ê¸°</span>
                    <div id="keywordSpinner" class="animate-spin rounded-full h-5 w-5 border-b-2 ml-2 hidden" style="border-bottom-color: var(--accent-text-color);"></div>
                </button>
                <button id="backToKeywordSubSelectionFromDirect" class="text-gray-500 hover:text-gray-400 w-full text-center mt-4 text-xs transition">
                    ë‹¤ë¥¸ í‚¤ì›Œë“œ ì…ë ¥ ë°©ì‹ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                </button>
            </div>

            <!-- ========================================================================= -->
            <!-- [G] 2B. KEYWORD ëª©ë¡ ì„ íƒ í¼ -->
            <!-- ========================================================================= -->
            <div id="selectionForm" class="hidden max-w-4xl mx-auto space-y-6 p-8 rounded-lg modern-block" style="background-color: var(--card-bg-color);">
                <p class="text-gray-300 font-medium text-base border-b border-gray-700 pb-4">ì›í•˜ëŠ” í‚¤ì›Œë“œë¥¼ **ìµœì†Œ 3ê°œ ì´ìƒ** ì„ íƒí•´ ì£¼ì„¸ìš”. (í´ë¦­í•˜ë©´ ì„ íƒë©ë‹ˆë‹¤)</p>
                
                <!-- í‚¤ì›Œë“œ íƒœê·¸ê°€ í‘œì‹œë˜ëŠ” ì»¨í…Œì´ë„ˆ -->
                <div id="keywordTagContainer" class="flex flex-wrap gap-2 p-4 rounded-md border border-gray-700 min-h-[100px]" style="background-color: var(--input-bg-color);">
                    <!-- í‚¤ì›Œë“œ íƒœê·¸ ë””ìì¸ì€ CSS ë³€ìˆ˜ì™€ .keyword-tag í´ë˜ìŠ¤ë¡œ ì œì–´ë©ë‹ˆë‹¤. -->
                </div>
                
                <div class="text-center font-semibold text-gray-400 text-base" id="selectedKeywordCount">ì„ íƒëœ í‚¤ì›Œë“œ: 0ê°œ</div>

                <button id="getSelectedRecommendationBtn" class="main-action-btn w-full py-4 rounded-md font-bold text-lg transition duration-300 shadow-xl mt-6 flex items-center justify-center">
                    <span id="selectionBtnText">ì„ íƒëœ í‚¤ì›Œë“œ ê¸°ë°˜ ì˜í™” 5í¸ ì¶”ì²œë°›ê¸°</span>
                    <div id="selectionSpinner" class="animate-spin rounded-full h-5 w-5 border-b-2 ml-2 hidden" style="border-bottom-color: var(--accent-text-color);"></div>
                </button>
                <button id="backToKeywordSubSelectionFromSelect" class="text-gray-500 hover:text-gray-400 w-full text-center mt-4 text-xs transition">
                    ë‹¤ë¥¸ í‚¤ì›Œë“œ ì…ë ¥ ë°©ì‹ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                </button>
            </div>


            <!-- ========================================================================= -->
            <!-- [H] ì¶”ì²œ ê²°ê³¼ ì¶œë ¥ ë¸”ë¡ (í°ìƒ‰ ë ˆì´ì•„ì›ƒ) -->
            <!-- ========================================================================= -->
            <div id="recommendationOutput" class="mt-12 p-8 bg-white text-gray-900 rounded-lg shadow-2xl hidden">
                <!-- 
                    - mt-12: ìƒë‹¨ ë§ˆì§„
                    - p-8: ë‚´ë¶€ íŒ¨ë”©
                    - bg-white: ë°°ê²½ìƒ‰ í°ìƒ‰ (ê³ ì •)
                    - text-gray-900: ê¸€ììƒ‰ ì§™ì€ íšŒìƒ‰ (ê³ ì •)
                    - rounded-lg: ëª¨ì„œë¦¬ ë‘¥ê¸€ê¸°
                    - shadow-2xl: ê·¸ë¦¼ì íš¨ê³¼
                -->
                
                <h4 class="text-3xl font-bold text-gray-900 mb-6 uppercase">âœ¨ ì¶”ì²œ ê²°ê³¼</h4>
                
                <div id="aiRecommendationContent" class="leading-relaxed whitespace-pre-wrap text-gray-700 text-base">
                    <!-- ì˜í™” ì¶”ì²œ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤. -->
                </div>
                
                <!-- 2. ì¶œì²˜ ì •ë³´ -->
                <div id="aiSources" class="mt-6 text-sm text-gray-500 font-light">
                    <!-- ê²€ìƒ‰ ì¶œì²˜ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤. -->
                </div>
            </div>
            
        </div>

    <!-- Application Logic -->
    <script type="module">
        const API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent";
        
        // --- ğŸ”‘ API KEY ì„¤ì • (í•„ìˆ˜) ---
        // ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨
        const API_KEY = "AIzaSyDsEmoqYmgJAn6r_Gtrc6rKUkqalvV5gEY"; // ìº”ë²„ìŠ¤ í™˜ê²½ì—ì„œ ìë™ ì œê³µë¨
        // ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†
        
        // --- DOM ELEMENTS ---
        const selectionView = document.getElementById('selectionView');
        const serviceView = document.getElementById('serviceView');
        const serviceTitle = document.getElementById('serviceTitle');
        const loading = document.getElementById('loading');
        const loadingText = document.getElementById('loadingText');
        const recommendationOutput = document.getElementById('recommendationOutput');
        const aiRecommendationContent = document.getElementById('aiRecommendationContent');
        const aiSources = document.getElementById('aiSources');
        const backToSelection = document.getElementById('backToSelection');
        
        // Vibe/History Elements
        const selectVibe = document.getElementById('selectVibe'); // Card DIV
        const vibeForm = document.getElementById('vibeForm');
        const vibeInputsContainer = document.getElementById('vibeInputsContainer'); // ì…ë ¥ í•„ë“œ ì»¨í…Œì´ë„ˆ
        const addVibeMovieInputBtn = document.getElementById('addVibeMovieInputBtn'); // ì…ë ¥ í•„ë“œ ì¶”ê°€ ë²„íŠ¼
        const getVibeRecommendationBtn = document.getElementById('getVibeRecommendationBtn');

        // Keyword Elements
        const selectKeyword = document.getElementById('selectKeyword'); // Card DIV
        const keywordSubSelectionView = document.getElementById('keywordSubSelectionView');
        const selectDirectInput = document.getElementById('selectDirectInput');
        const selectKeywordList = document.getElementById('selectKeywordList');
        
        // Keyword Direct Input Elements
        const keywordForm = document.getElementById('keywordForm');
        const keywordInput = document.getElementById('keywordInput');
        const getKeywordRecommendationBtn = document.getElementById('getKeywordRecommendationBtn');
        const backToKeywordSubSelectionFromDirect = document.getElementById('backToKeywordSubSelectionFromDirect');

        // Keyword Selection List Elements
        const selectionForm = document.getElementById('selectionForm');
        const keywordTagContainer = document.getElementById('keywordTagContainer');
        const selectedKeywordCount = document.getElementById('selectedKeywordCount');
        const getSelectedRecommendationBtn = document.getElementById('getSelectedRecommendationBtn');
        const backToKeywordSubSelectionFromSelect = document.getElementById('backToKeywordSubSelectionFromSelect');

        // State
        let selectedKeywords = new Set();

        // --- UTILITY FUNCTIONS ---
        
        // Hides all service views and shows only the target view
        function showView(target) {
            [vibeForm, keywordSubSelectionView, keywordForm, selectionForm, loading, recommendationOutput].forEach(el => el.classList.add('hidden'));
            if (target) {
                target.classList.remove('hidden');
            }
        }

        function setLoading(isLoading, text = "ì˜í™” ë°ì´í„°ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...") {
            if (isLoading) {
                selectionView.classList.add('hidden');
                serviceView.classList.remove('hidden');
                showView(loading);
                loadingText.textContent = text;
            } else {
                loading.classList.add('hidden');
            }
        }

        // --- KEYWORD DATA & RENDER ---
        
        const ALL_KEYWORDS = [
            "ì•¡ì…˜", "ìŠ¤ë¦´ëŸ¬", "SF", "íŒíƒ€ì§€", "ë“œë¼ë§ˆ", "ì½”ë¯¸ë””", "ë¡œë§¨ìŠ¤", "ëŠì™€ë¥´", 
            "ë²”ì£„", "ê³µí¬(í˜¸ëŸ¬)", "ë¯¸ìŠ¤í„°ë¦¬", "ì „ìŸ", "ë®¤ì§€ì»¬", "ë‹¤íë©˜í„°ë¦¬", "ì• ë‹ˆë©”ì´ì…˜",
            "ì„œë¶€ê·¹", "ë¬´í˜‘", "ì²©ë³´", "ì¬ë‚œ", "ì‹¤í—˜ ì˜í™”",
            "ë³µìˆ˜", "ì„±ì¥", "ë°˜ì „", "ìŒëª¨ë¡ ", "ë””ìŠ¤í† í”¼ì•„", "íœ´ë¨¸ë‹ˆì¦˜", "ê°€ì¡±", "ì—­ì‚¬", 
            "ì •ì¹˜", "ë²•ì •", "ì¢…êµ", "í™˜ê²½", "ìŠ¤í¬ì¸ ", "ì‹œê°„ ì—¬í–‰", "ì¸ê³µì§€ëŠ¥", "SF ìŠ¤ë¦´ëŸ¬", 
            "í•™êµ í­ë ¥", "ì‚¬íšŒ ë¹„íŒ", "ë¸”ë™ ì½”ë¯¸ë””", "ì‹¤í™” ê¸°ë°˜", "ì •ì²´ì„± íƒêµ¬", "ì˜ˆìˆ ê°€", 
            "ì²­ì†Œë…„", "ìš°ì£¼", "ì´ˆìì—°", "ìŒì•…", "ì…°ìµìŠ¤í”¼ì–´ ê°ìƒ‰", "ì•¡ì…˜ ì½”ë¯¸ë””",
            "ì•„ë¦„ë‹¤ìš´ ì˜ìƒë¯¸", "ìŠ¬í”ˆ", "ì”í˜¹í•œ", "ê°€ìŠ´ ë”°ëœ»í•œ", "ì² í•™ì ì¸", "ìœ ì¾Œí•œ", 
            "Bê¸‰ ê°ì„±", "ëª½í™˜ì ì¸", "ê¸´ì¥ê° ë„˜ì¹˜ëŠ”", "íë§", "ê³ ì „ë¯¸", "í‚¤ì¹˜", "ê°•ë ¬í•œ", 
            "ì”ì”í•œ", "ì»¬ëŸ¬í’€í•œ", "í‘ë°±", "í•¸ë“œí—¬ë“œ", "ì˜´ë‹ˆë²„ìŠ¤ì‹", "ë³‘ë§›", "ê·¹ì ì¸", 
            "í‡´íì ì¸", "ë¯¸ë‹ˆë©€ë¦¬ì¦˜", "ëŠë¦° í˜¸í¡", "íŒ¨ì…”ë„ˆë¸”í•œ", "ë…íŠ¹í•œ ìºë¦­í„°", 
            "ìŒí–¥ íš¨ê³¼ ê°•ì¡°", "ì‹œê° íš¨ê³¼ ê·¹ëŒ€í™”",
            "í•œêµ­ ì˜í™”", "ë¯¸êµ­ ì˜í™”", "ìœ ëŸ½ ì˜í™”", "ì•„ì‹œì•„ ì˜í™”", "80ë…„ëŒ€", "90ë…„ëŒ€", 
            "2000ë…„ëŒ€", "ìµœì‹ ì‘", "ë…ë¦½ì˜í™”", "ì˜êµ­ ì˜í™”", "í”„ë‘ìŠ¤ ì˜í™”", "ì¼ë³¸ ì˜í™”", 
            "ì¤‘êµ­ ì˜í™”", "ëŸ¬ì‹œì•„ ì˜í™”", "ë‚¨ë¯¸ ì˜í™”", "í˜¸ì£¼ ì˜í™”", "1950ë…„ëŒ€", "1960ë…„ëŒ€", 
            "1970ë…„ëŒ€", "2010ë…„ëŒ€", "2020ë…„ëŒ€", "íŒíƒ€ì§€ ë¸”ë¡ë²„ìŠ¤í„°", "ìˆ¨ê²¨ì§„ ëª…ì‘", "ë‹¨í¸ ì˜í™”"
        ];
        // --- END OF KEYWORD DATA ---

        function renderKeywords() {
            keywordTagContainer.innerHTML = '';
            ALL_KEYWORDS.forEach(keyword => {
                const tag = document.createElement('span');
                tag.textContent = keyword;
                tag.className = 'keyword-tag inline-block px-4 py-2 text-sm font-medium rounded-full hover:bg-gray-800 transition duration-150 ease-in-out';
                tag.dataset.keyword = keyword;
                
                if (selectedKeywords.has(keyword)) {
                    tag.classList.add('selected');
                }

                tag.addEventListener('click', () => toggleKeyword(keyword, tag));
                keywordTagContainer.appendChild(tag);
            });
            updateSelectedCount();
        }

        function toggleKeyword(keyword, tag) {
            if (selectedKeywords.has(keyword)) {
                selectedKeywords.delete(keyword);
                tag.classList.remove('selected');
            } else if (selectedKeywords.size < 8) {
                selectedKeywords.add(keyword);
                tag.classList.add('selected');
            } else {
                // Custom alert message
                aiRecommendationContent.innerHTML = '<p class="text-red-500 font-bold">âš ï¸ ê²½ê³ : í‚¤ì›Œë“œëŠ” ìµœëŒ€ 8ê°œê¹Œì§€ë§Œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>';
                recommendationOutput.classList.remove('hidden');
                showView(recommendationOutput);
                setTimeout(() => {
                    showView(selectionForm);
                }, 3000);
            }
            updateSelectedCount();
        }

        function updateSelectedCount() {
            selectedKeywordCount.textContent = `ì„ íƒëœ í‚¤ì›Œë“œ: ${selectedKeywords.size}ê°œ`;
        }
        
        // --- API CALL LOGIC (Text) ---
        
        async function callGeminiApi(systemPrompt, userQuery) {
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }], // Enable grounding
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            const MAX_RETRIES = 3;
            for (let attempt = 0; attempt < MAX_RETRIES; attempt++) {
                try {
                    const response = await fetch(`${API_URL}?key=${API_KEY}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                         if (response.status === 403) {
                            throw new Error("403 Forbidden: API Key ê¶Œí•œ ë¬¸ì œ ë˜ëŠ” ì˜ëª»ëœ í‚¤ì…ë‹ˆë‹¤.");
                        }
                        const errorBody = await response.json();
                        throw new Error(`API í˜¸ì¶œ ì‹¤íŒ¨ (Status: ${response.status}, Detail: ${JSON.stringify(errorBody)}`);
                    }

                    const result = await response.json();
                    const candidate = result.candidates?.[0];

                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        const text = candidate.content.parts[0].text;
                        const sources = getGroundingSources(candidate);
                        return { text, sources };
                    }
                    throw new Error("API ì‘ë‹µì—ì„œ ìœ íš¨í•œ í…ìŠ¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");

                } catch (error) {
                    console.error(`Attempt ${attempt + 1} failed:`, error.message);
                    if (attempt === MAX_RETRIES - 1) {
                         if (error.message.includes("403 Forbidden")) {
                            aiRecommendationContent.innerHTML = '<p class="text-red-500 font-bold">ğŸš¨ ì¶”ì²œ ì‹¤íŒ¨: API í˜¸ì¶œì— ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í‚¤ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.</p>';
                        } else {
                            aiRecommendationContent.innerHTML = `<p class="text-red-500 font-bold">ğŸš¨ ì¶”ì²œ ì‹¤íŒ¨: API í˜¸ì¶œì— ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (${error.message}) ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.</p>`;
                        }
                        setLoading(false);
                        recommendationOutput.classList.remove('hidden');
                        return null;
                    }
                    await new Promise(resolve => setTimeout(resolve, Math.pow(2, attempt) * 1000));
                }
            }
        }
        
        function getGroundingSources(candidate) {
            const sources = [];
            const groundingMetadata = candidate.groundingMetadata;
            if (groundingMetadata && groundingMetadata.groundingAttributions) {
                groundingMetadata.groundingAttributions
                    .map(attribution => ({
                        uri: attribution.web?.uri,
                        title: attribution.web?.title,
                    }))
                    .filter(source => source.uri && source.title)
                    .forEach(source => sources.push(source));
            }
            return sources;
        }

        // --- MARKDOWN & RENDERING ---
        
        // Basic Markdown formatter for text blocks
        function formatMarkdown(text) {
            if (!text) return '';
            
            text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            text = text.replace(/\n\* (.*)/g, '\n<li>$1</li>');
            text = text.replace(/(\n<li>.*<\/li>)/g, '<ul class="list-disc list-inside mb-4 pl-4">$1</ul>');
            
            text = text.replace(/\n/g, '<br>');

            return text;
        }

        // Formatter that identifies movie sections and extracts the title to generate the search URL
        function formatRecommendationText(text) {
            if (!text) return '';
            
            // 1. ì²« ë²ˆì§¸ ###ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë„ì…ë¶€ì™€ ì˜í™” ëª©ë¡ì„ ë¶„ë¦¬
            const firstMovieIndex = text.indexOf('### ');
            let introText = '';
            let movieSections = text;
            
            if (firstMovieIndex > -1) {
                introText = text.substring(0, firstMovieIndex).trim();
                movieSections = text.substring(firstMovieIndex).trim();
            }

            let html = '';
            
            // 2. ë„ì…ë¶€ í¬ë§·íŒ… ë° ì—¬ë°± ìµœì†Œí™” (mb-2ë¡œ ìµœì†Œí™”)
            if (introText) {
                 // mb-2ë¡œ ìƒë‹¨ ì—¬ë°±ì„ ìµœì†Œí™”
                html += `<p class="mb-2 font-normal text-gray-800">${formatMarkdown(introText)}</p>`;
            }
            
            // 3. ì˜í™” ì„¹ì…˜ ë¶„ë¦¬ ë° í¬ë§·íŒ…
            const sections = movieSections.split(/^### /gm).filter(s => s.trim() !== '');

            sections.forEach((section, index) => {
                const titleMatch = section.match(/^(.*?)\n/);
                const rawTitleWithNumber = titleMatch ? titleMatch[1].trim() : `ì¶”ì²œ ì˜í™” ${index + 1}`;
                
                // ì´ì „ ë²„ì „ì˜ [SEARCH_URL:...] íƒœê·¸ë¥¼ ì œê±°í•˜ëŠ” ë¡œì§. ì´ì œ LLMì€ ì´ íƒœê·¸ë¥¼ ìƒì„±í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                const urlPattern = /\[SEARCH_URL:(.*?)\]/;
                let movieContent = section.substring(titleMatch ? titleMatch[0].length : 0);
                if (movieContent.match(urlPattern)) {
                    movieContent = movieContent.replace(movieContent.match(urlPattern)[0], '').trim();
                }

                
                // ì œëª©ì—ì„œ í•œêµ­ì–´ ì œëª©ê³¼ (ì˜ì–´ ì œëª©)ì„ ì¶”ì¶œ
                const titleRegex = /^(?:[0-9]+\.\s*)?(.*?)\s*\((.*?)\)$/;
                const fullTitleMatch = rawTitleWithNumber.match(titleRegex);

                let koreanTitle = rawTitleWithNumber;
                let englishTitle = '';

                if (fullTitleMatch) {
                    // [ë²ˆí˜¸.]ì™€ ê³µë°±ì„ ì œê±°í•˜ê³  ìˆœìˆ˜í•œ í•œêµ­ì–´ ì œëª©ë§Œ ì¶”ì¶œ
                    koreanTitle = fullTitleMatch[1].trim().replace(/^[0-9]+\.\s*/, ''); 
                    englishTitle = fullTitleMatch[2].trim();
                } else {
                    // í•œêµ­ì–´ ì œëª©ë§Œ ìˆì„ ê²½ìš°, í˜•ì‹ì— ë§ì§€ ì•Šë”ë¼ë„ ì‚¬ìš©
                    koreanTitle = rawTitleWithNumber.trim().replace(/^[0-9]+\.\s*/, '');
                }

                // [í•µì‹¬: ê²€ìƒ‰ ê¸°ëŠ¥ ìˆ˜ì • ë¶€ë¶„] í•œêµ­ì–´ ì œëª©ì„ ì´ìš©í•´ êµ¬ê¸€ ê²€ìƒ‰ URLì„ ë™ì ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.
                const googleSearchBase = 'https://www.google.com/search?q=';
                // ê²€ìƒ‰ ì •í™•ë„ë¥¼ ìœ„í•´ ' ì˜í™”'ë¥¼ ì¶”ê°€í•˜ê³  URL ì¸ì½”ë”©í•©ë‹ˆë‹¤.
                const encodedTitle = encodeURIComponent(koreanTitle + ' ì˜í™”'); 
                const searchUrl = googleSearchBase + encodedTitle;

                
                movieContent = formatMarkdown(movieContent);
                
                // ì˜í™” ì¶”ì²œ í•­ëª©ë³„ ë””ìì¸ ì„¤ì •
                const topMarginClass = index === 0 ? 'mt-2' : 'mt-6';
                const borderClass = index === 0 ? '' : 'pt-4 border-t border-gray-300';
                
                html += `
                    <div class="movie-recommendation-item ${topMarginClass} mb-6 ${borderClass}">
                        <h3 class="text-2xl font-bold text-gray-900 mb-2">
                            <div class="flex items-center justify-between flex-wrap gap-y-2">
                                <!-- ì œëª© ë¸”ë¡ -->
                                <div class="title-block">
                                    <span class="korean-title block text-xl font-bold">${koreanTitle}</span>
                                    <span class="english-title block text-lg font-normal text-gray-600">${englishTitle}</span>
                                </div>
                                
                                <!-- ê²€ìƒ‰ ë²„íŠ¼: ë™ì ìœ¼ë¡œ ìƒì„±ëœ searchUrl ì‚¬ìš© -->
                                <a href="${searchUrl}" target="_blank" class="search-btn text-sm px-3 py-1 rounded-full bg-gray-400 text-gray-800 hover:bg-gray-500 transition duration-150 flex items-center whitespace-nowrap ml-4">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                                    ê²€ìƒ‰
                                </a>
                            </div>
                        </h3>
                        ${movieContent}
                    </div>
                `;
            });
            return html;
        }


        async function displayRecommendation(result) {
            setLoading(false);
            showView(recommendationOutput);

            aiRecommendationContent.innerHTML = formatRecommendationText(result.text);

            aiSources.innerHTML = 'ì¶œì²˜: ';
            if (result.sources.length > 0) {
                const sourceLinks = result.sources.map((src, index) => 
                    `<a href="${src.uri}" target="_blank" class="text-blue-600 hover:text-blue-800 transition underline">${src.title || `ì¶œì²˜ ${index + 1}`}</a>`
                ).join(' | ');
                aiSources.innerHTML += sourceLinks;
            } else {
                 aiSources.innerHTML += 'êµ¬ê¸€ ê²€ìƒ‰ ê²°ê³¼ë¥¼ í™œìš©í–ˆìŠµë‹ˆë‹¤.';
            }
            
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }
        
        // --- DYNAMIC VIBE INPUT LOGIC ---

        // ìƒˆë¡œìš´ ì…ë ¥ í•„ë“œ ìƒì„± í•¨ìˆ˜
        function createNewMovieInput() {
            const inputCount = vibeInputsContainer.querySelectorAll('[data-movie-input]').length + 1;
            const input = document.createElement('input');
            
            input.type = 'text';
            input.placeholder = `ì¢‹ì•„í•˜ëŠ” ì˜í™” ${inputCount} (ì„ íƒ)`;
            input.className = 'vibe-movie-input w-full p-4 border border-gray-700 rounded-md focus:ring-white/50 focus:border-white/50 text-white placeholder-gray-500';
            input.style.backgroundColor = 'var(--input-bg-color)';
            input.setAttribute('data-movie-input', ''); // ì¿¼ë¦¬ìš© ë§ˆì»¤
            
            vibeInputsContainer.appendChild(input);
            input.focus();
        }


        // --- HANDLERS ---
        
        function handleServiceSelection(service) {
            selectionView.classList.add('hidden');
            serviceView.classList.remove('hidden');
            recommendationOutput.classList.add('hidden');
            
            if (service === 'vibe') {
                serviceTitle.textContent = "ì‹œì²­ ê¸°ë¡ ê¸°ë°˜ (VIBE) ëª¨ë“œ";
                showView(vibeForm);
            } else if (service === 'keyword') {
                serviceTitle.textContent = "í‚¤ì›Œë“œ ê¸°ë°˜ (NARROW) ëª¨ë“œ";
                showView(keywordSubSelectionView);
            }
        }
        
        selectVibe.addEventListener('click', () => handleServiceSelection('vibe'));
        selectKeyword.addEventListener('click', () => handleServiceSelection('keyword'));
        
        selectDirectInput.addEventListener('click', () => {
            showView(keywordForm);
        });
        selectKeywordList.addEventListener('click', () => {
            showView(selectionForm);
            renderKeywords(); 
        });
        
        backToSelection.addEventListener('click', () => {
            serviceView.classList.add('hidden');
            selectionView.classList.remove('hidden');
            recommendationOutput.classList.add('hidden');
            selectedKeywords.clear();
            
            // VIBE ì…ë ¥ í•„ë“œ ì´ˆê¸°í™” (3ê°œë¡œ ë³µì›)
            vibeInputsContainer.innerHTML = `
                <input type="text" data-movie-input placeholder="ì¢‹ì•„í•˜ëŠ” ì˜í™” 1 (í•„ìˆ˜)" class="vibe-movie-input w-full p-4 border border-gray-700 rounded-md focus:ring-white/50 focus:border-white/50 text-white placeholder-gray-500" style="background-color: var(--input-bg-color);">
                <input type="text" data-movie-input placeholder="ì¢‹ì•„í•˜ëŠ” ì˜í™” 2 (ì„ íƒ)" class="vibe-movie-input w-full p-4 border border-gray-700 rounded-md focus:ring-white/50 focus:border-white/50 text-white placeholder-gray-500" style="background-color: var(--input-bg-color);">
                <input type="text" data-movie-input placeholder="ì¢‹ì•„í•˜ëŠ” ì˜í™” 3 (ì„ íƒ)" class="vibe-movie-input w-full p-4 border border-gray-700 rounded-md focus:ring-white/50 focus:border-white/50 text-white placeholder-gray-500" style="background-color: var(--input-bg-color);">
            `;

            keywordInput.value = '';
            renderKeywords();
        });

        backToKeywordSubSelectionFromDirect.addEventListener('click', () => {
            showView(keywordSubSelectionView);
        });

        backToKeywordSubSelectionFromSelect.addEventListener('click', () => {
            showView(keywordSubSelectionView);
        });
        
        // VIBE ì…ë ¥ í•„ë“œ ì¶”ê°€ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        addVibeMovieInputBtn.addEventListener('click', createNewMovieInput);

        // Vibe/History recommendation request (ê¸°ëŠ¥ ì½”ë“œ)
        getVibeRecommendationBtn.addEventListener('click', async () => {
            // ëª¨ë“  ì˜í™” ì…ë ¥ í•„ë“œì—ì„œ ê°’ì„ ìˆ˜ì§‘
            const allInputs = vibeInputsContainer.querySelectorAll('[data-movie-input]');
            const movies = Array.from(allInputs)
                                .map(input => input.value.trim())
                                .filter(t => t); // ë¹ˆ ë¬¸ìì—´ ì œê±°

            // ìœ íš¨ì„± ê²€ì‚¬: ìµœì†Œ 1ê°œì˜ ì˜í™” ì œëª©ì´ í•„ìš”í•¨ (ìˆ˜ì •ë¨)
            if (movies.length < 1) { 
                aiRecommendationContent.innerHTML = '<p class="text-red-500 font-bold">âš ï¸ ê²½ê³ : ìµœì†Œ 1ê°œì˜ ì˜í™” ì œëª©ì„ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.</p>'; 
                recommendationOutput.classList.remove('hidden'); 
                showView(recommendationOutput); // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ í›„ í¼ ë·°ë¡œ ëŒì•„ê°
                return; 
            }
            
            setLoading(true, `[${movies.join(', ')}] ì˜í™”ë“¤ì˜ ë¶„ìœ„ê¸°ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...`); recommendationOutput.classList.add('hidden');
            const movieString = movies.join(', ');
            // LLMì—ê²Œ ê²€ìƒ‰ ë§í¬ë¥¼ ë§Œë“¤ì§€ ë§ê³ , ê¹”ë”í•˜ê²Œ ì œëª©ê³¼ ì„¤ëª…ë§Œ ë‹¬ë¼ê³  ìš”ì²­í–ˆìŠµë‹ˆë‹¤.
            const systemPrompt = `ë‹¹ì‹ ì€ ì„¸ê³„ ìµœê³ ì˜ ì˜í™” íë ˆì´í„°ì…ë‹ˆë‹¤. í•œêµ­ì–´ë¡œ ì‘ë‹µí•´ì•¼ í•˜ë©°, ì‚¬ìš©ìê°€ ì œê³µí•œ ì˜í™” ${movies.length}í¸ì„ ë¶„ì„í•˜ì—¬ ê·¸ë“¤ì˜ ê³µí†µëœ ë¶„ìœ„ê¸°(vibe), ì¥ë¥´, ì£¼ì œë¥¼ ì™„ë²½í•˜ê²Œ ë§Œì¡±ì‹œí‚¤ëŠ” ìƒˆë¡œìš´ ì˜í™” 5í¸ì„ ì¶”ì²œí•´ ì£¼ì„¸ìš”. 1. ì¶”ì²œí•˜ëŠ” ì˜í™” 5í¸ì€ ì‚¬ìš©ìê°€ ì´ë¯¸ ì œê³µí•œ ì˜í™”ë“¤ê³¼ëŠ” ë‹¤ë¥¸ ì˜í™”ì—¬ì•¼ í•©ë‹ˆë‹¤. 2. ê° ì¶”ì²œ ì˜í™” ì œëª©ì€ í•­ìƒ '###'ë¡œ ì‹œì‘í•´ì•¼ í•˜ë©°, **ë°˜ë“œì‹œ '### [ë²ˆí˜¸]. [í•œêµ­ì–´ ì œëª©] ([ì˜ì–´ ì œëª©])' í˜•ì‹ìœ¼ë¡œ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤.** (ì˜ˆ: '### 1. ê¸°ìƒì¶© (Parasite)'). 3. ì˜í™” ì„¤ëª…ì—ëŠ” ì ˆëŒ€ë¡œ ê²€ìƒ‰ ë§í¬ë‚˜ URLì„ ì‚½ì…í•˜ì§€ ë§ˆì„¸ìš”.`;
            const userQuery = `ì´ì „ì— ì‹œì²­í•œ ì˜í™”: ${movieString}. ì´ ì˜í™”ë“¤ì˜ ë¶„ìœ„ê¸°ì™€ ê³µí†µì ì„ ë°”íƒ•ìœ¼ë¡œ ë‹¤ë¥¸ ì˜í™” 5í¸ì„ ì¶”ì²œí•´ ì£¼ì„¸ìš”.`;

            const result = await callGeminiApi(systemPrompt, userQuery);
            if (result) {
                displayRecommendation(result);
            }
        });

        // Keyword Direct Input recommendation request (ê¸°ëŠ¥ ì½”ë“œ)
        getKeywordRecommendationBtn.addEventListener('click', async () => {
            const keyword = keywordInput.value.trim();
            
            if (!keyword) {
                aiRecommendationContent.innerHTML = '<p class="text-red-500 font-bold">âš ï¸ ê²½ê³ : ì›í•˜ëŠ” í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.</p>';
                recommendationOutput.classList.remove('hidden'); 
                showView(recommendationOutput);
                return;
            }

            setLoading(true, `[${keyword}] í‚¤ì›Œë“œì— ë§ëŠ” ì˜í™”ë¥¼ ê²€ìƒ‰ ì¤‘ì…ë‹ˆë‹¤...`); recommendationOutput.classList.add('hidden');
            // LLMì—ê²Œ ê²€ìƒ‰ ë§í¬ë¥¼ ë§Œë“¤ì§€ ë§ê³ , ê¹”ë”í•˜ê²Œ ì œëª©ê³¼ ì„¤ëª…ë§Œ ë‹¬ë¼ê³  ìš”ì²­í–ˆìŠµë‹ˆë‹¤.
            const systemPrompt = `ë‹¹ì‹ ì€ ì„¸ê³„ ìµœê³ ì˜ ì˜í™” íë ˆì´í„°ì…ë‹ˆë‹¤. í•œêµ­ì–´ë¡œ ì‘ë‹µí•´ì•¼ í•˜ë©°, ì‚¬ìš©ìê°€ ì œê³µí•œ í‚¤ì›Œë“œ/ììœ  ì„œìˆ ì„ ë°”íƒ•ìœ¼ë¡œ ê°€ì¥ ì í•©í•˜ê³  í¥ë¯¸ë¡œìš´ ì˜í™” 5í¸ì„ ì¶”ì²œí•´ ì£¼ì„¸ìš”. 1. ê° ì¶”ì²œ ì˜í™” ì œëª©ì€ í•­ìƒ '###'ë¡œ ì‹œì‘í•´ì•¼ í•˜ë©°, **ë°˜ë“œì‹œ '### [ë²ˆí˜¸]. [í•œêµ­ì–´ ì œëª©] ([ì˜ì–´ ì œëª©])' í˜•ì‹ìœ¼ë¡œ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤.** (ì˜ˆ: '### 1. ê¸°ìƒì¶© (Parasite)'). 2. ì˜í™” ì„¤ëª…ì—ëŠ” ì ˆëŒ€ë¡œ ê²€ìƒ‰ ë§í¬ë‚˜ URLì„ ì‚½ì…í•˜ì§€ ë§ˆì„¸ìš”.`;
            const userQuery = `ììœ  ì…ë ¥ í‚¤ì›Œë“œ: ${keyword}. ì´ í‚¤ì›Œë“œì— ë§ëŠ” ì˜í™” 5í¸ì„ ì¶”ì²œí•´ ì£¼ì„¸ìš”.`;

            const result = await callGeminiApi(systemPrompt, userQuery);
            if (result) {
                displayRecommendation(result);
            }
        });

        // Keyword Selection List recommendation request (ê¸°ëŠ¥ ì½”ë“œ)
        getSelectedRecommendationBtn.addEventListener('click', async () => {
            const keywords = Array.from(selectedKeywords);

            if (keywords.length < 3) {
                 aiRecommendationContent.innerHTML = '<p class="text-red-500 font-bold">âš ï¸ ê²½ê³ : ì˜í™” ì¶”ì²œì˜ ì •êµí•¨ì„ ìœ„í•´ ìµœì†Œ 3ê°œ ì´ìƒì˜ í‚¤ì›Œë“œë¥¼ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.</p>'; 
                 recommendationOutput.classList.remove('hidden'); 
                 showView(recommendationOutput);
                 return;
            }

            setLoading(true, `[${keywords.join(', ')}] í‚¤ì›Œë“œ ì¡°í•©ì— ë§ëŠ” ì˜í™”ë¥¼ ê²€ìƒ‰ ì¤‘ì…ë‹ˆë‹¤...`); recommendationOutput.classList.add('hidden');
            const keywordString = keywords.join(', ');
            // LLMì—ê²Œ ê²€ìƒ‰ ë§í¬ë¥¼ ë§Œë“¤ì§€ ë§ê³ , ê¹”ë”í•˜ê²Œ ì œëª©ê³¼ ì„¤ëª…ë§Œ ë‹¬ë¼ê³  ìš”ì²­í–ˆìŠµë‹ˆë‹¤.
            const systemPrompt = `ë‹¹ì‹ ì€ ì„¸ê³„ ìµœê³ ì˜ ì˜í™” íë ˆì´í„°ì…ë‹ˆë‹¤. í•œêµ­ì–´ë¡œ ì‘ë‹µí•´ì•¼ í•˜ë©°, ì‚¬ìš©ìê°€ ì œê³µí•œ í‚¤ì›Œë“œ ì¡°í•©ì„ ì™„ë²½í•˜ê²Œ ë§Œì¡±ì‹œí‚¤ëŠ” ì˜í™” 5í¸ì„ ì¶”ì²œí•´ ì£¼ì„¸ìš”. 1. ê° ì¶”ì²œ ì˜í™” ì œëª©ì€ í•­ìƒ '###'ë¡œ ì‹œì‘í•´ì•¼ í•˜ë©°, **ë°˜ë“œì‹œ '### [ë²ˆí˜¸]. [í•œêµ­ì–´ ì œëª©] ([ì˜ì–´ ì œëª©])' í˜•ì‹ìœ¼ë¡œ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤.** (ì˜ˆ: '### 1. ê¸°ìƒì¶© (Parasite)'). 2. ì˜í™” ì„¤ëª…ì—ëŠ” ì ˆëŒ€ë¡œ ê²€ìƒ‰ ë§í¬ë‚˜ URLì„ ì‚½ì…í•˜ì§€ ë§ˆì„¸ìš”.`;
            const userQuery = `ì„ íƒëœ í‚¤ì›Œë“œ: ${keywordString}. ì´ ì¡°í•©ì— ë§ëŠ” ì˜í™” 5í¸ì„ ì¶”ì²œí•´ ì£¼ì„¸ìš”.`;

            const result = await callGeminiApi(systemPrompt, userQuery);
            if (result) {
                displayRecommendation(result);
            }
        });

        // Initial setup
        window.onload = () => {
            renderKeywords(); // í‚¤ì›Œë“œ ëª©ë¡ì„ ì´ˆê¸° ë¡œë“œ
        };

    </script>
</body>
</html>
